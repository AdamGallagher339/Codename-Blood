<div class="app-container">
  <!-- Header -->
  <header class="app-header">
    <div class="header-content">
        <div class="logo" (click)="goHomeOrWelcome()">
        <span class="logo-icon"><img src="icons/logo.jpg" alt="Blood Bike" class="logo-img"></span>
        <h1>Blood Bike</h1>
      </div>
      <div class="header-actions">
        <div class="user-pill" *ngIf="auth.user() as me">
          <span class="user-name">{{ me.username || me.email || me.sub }}</span>
          <span class="user-roles" *ngIf="me.roles?.length">{{ me.roles.join(', ') }}</span>
        </div>
        <div class="settings-container">
          <button class="btn-settings" (click)="toggleSettings()" title="Settings">
            ‚öôÔ∏è
          </button>
          <div *ngIf="showSettings" class="settings-dropdown">
            <button class="settings-item" *ngIf="!auth.isLoggedIn()" (click)="navigateAuth('login')">
              <span>Login</span>
            </button>

            <ng-container *ngIf="auth.isLoggedIn()">
              <button class="settings-item" (click)="navigateTo('settings')">
                <span>Settings</span>
              </button>
              <button class="settings-item" (click)="navigateTo('profile')">
                <span>Profile</span>
              </button>
              <button class="settings-item" (click)="navigateTo('help')">
                <span>Help & Support</span>
              </button>
            </ng-container>
            <hr class="settings-divider">
            <button class="settings-item logout" *ngIf="auth.isLoggedIn()" (click)="logout()">
              <span>Logout</span>
            </button>
          </div>
        </div>
        <div *ngIf="currentPage !== 'home' && currentPage !== 'welcome'" class="header-actions">
          <button class="btn-back" (click)="goBack()" title="Go back">
            ‚Üê
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="app-main" (click)="showSettings = false">
    <!-- Routed Components (Scanner only) -->
    <div *ngIf="currentPage === 'scanner'">
      <router-outlet></router-outlet>
    </div>

    <!-- Inline Pages -->
    <div *ngIf="currentPage !== 'scanner'">
    <!-- Welcome / Auth Landing -->
    <div *ngIf="currentPage === 'welcome'" class="page auth-page">
      <div class="page-content">
        <div class="hero-section">
          <h2>Welcome</h2>
          <p>Sign in to coordinate blood deliveries</p>
        </div>

        <div class="auth-card">
          <p class="auth-hint">New here? Create an account and confirm your email.</p>
          <div class="auth-actions">
            <button class="primary" (click)="navigateAuth('login')">Login</button>
            <button class="secondary" (click)="navigateAuth('signup')">Sign up</button>
          </div>
          <p *ngIf="auth.lastAuthError()" class="auth-error">{{ auth.lastAuthError() }}</p>
        </div>
      </div>
    </div>

    <!-- Login Page -->
    <div *ngIf="currentPage === 'login'" class="page auth-page">
      <div class="page-header">
        <h2>Login</h2>
      </div>
      <div class="page-content">
        <div class="auth-card">
          <label>
            <span>Username</span>
            <input [(ngModel)]="loginUsername" placeholder="your username" autocomplete="username" />
          </label>
          <label>
            <span>Password</span>
            <input [(ngModel)]="loginPassword" type="password" placeholder="your password" autocomplete="current-password" />
          </label>
          <div class="auth-actions">
            <button class="primary" [disabled]="busy" (click)="signIn()">{{ busy ? 'Signing in‚Ä¶' : 'Sign in' }}</button>
            <button class="secondary" [disabled]="busy" (click)="navigateAuth('signup')">Create account</button>
          </div>
          <p *ngIf="auth.lastAuthError()" class="auth-error">{{ auth.lastAuthError() }}</p>
        </div>
      </div>
    </div>

    <!-- Signup Page -->
    <div *ngIf="currentPage === 'signup'" class="page auth-page">
      <div class="page-header">
        <h2>Sign up</h2>
      </div>
      <div class="page-content">
        <div class="auth-card">
          <label>
            <span>Email</span>
            <input [(ngModel)]="signupEmail" type="email" placeholder="you@example.com" autocomplete="email" />
          </label>
          <label>
            <span>Username</span>
            <input [(ngModel)]="signupUsername" placeholder="choose a username" autocomplete="username" />
          </label>
          <label>
            <span>Password</span>
            <input [(ngModel)]="signupPassword" type="password" placeholder="choose a password" autocomplete="new-password" />
          </label>
          <div class="auth-actions">
            <button class="primary" [disabled]="busy" (click)="signUp()">{{ busy ? 'Creating‚Ä¶' : 'Create account' }}</button>
            <button class="secondary" [disabled]="busy" (click)="navigateAuth('login')">Back to login</button>
          </div>
          <p class="auth-hint">You‚Äôll get an email verification code from Cognito.</p>
          <p *ngIf="auth.lastAuthError()" class="auth-error">{{ auth.lastAuthError() }}</p>
        </div>
      </div>
    </div>

    <!-- Confirm Email Page -->
    <div *ngIf="currentPage === 'confirm'" class="page auth-page">
      <div class="page-header">
        <h2>Confirm email</h2>
      </div>
      <div class="page-content">
        <div class="auth-card">
          <label>
            <span>Username</span>
            <input [(ngModel)]="confirmUsername" placeholder="username" autocomplete="username" />
          </label>
          <label>
            <span>Verification code</span>
            <input [(ngModel)]="confirmCode" placeholder="123456" inputmode="numeric" />
          </label>
          <div class="auth-actions">
            <button class="primary" [disabled]="busy" (click)="confirmSignUp()">{{ busy ? 'Confirming‚Ä¶' : 'Confirm' }}</button>
            <button class="secondary" [disabled]="busy" (click)="navigateAuth('login')">Back to login</button>
          </div>
          <p *ngIf="auth.lastAuthError()" class="auth-error">{{ auth.lastAuthError() }}</p>
        </div>
      </div>
    </div>

    <!-- Home Page -->
    <div *ngIf="currentPage === 'home'" class="page home-page">
      <div class="page-content">
        <div class="hero-section">
          <h2>Blood Bike</h2>
          <p>Real-time blood delivery coordination</p>
        </div>

        <div class="menu-grid">
          <button
            *ngFor="let page of pages"
            (click)="navigateTo(page.id)"
            class="menu-card"
            [class.active]="currentPage === page.id"
          >
            <span class="menu-icon">{{ page.icon }}</span>
            <span class="menu-title">{{ page.title }}</span>
          </button>
        </div>

        <div class="info-section">
          <p class="info-text">Tap any section above to explore</p>
        </div>
      </div>
    </div>

    <!-- Map Page -->
    <div *ngIf="currentPage === 'map'" class="page map-page">
      <div class="page-header">
        <h2>üìç Live Map</h2>
      </div>
      <div class="page-content">
        <div class="placeholder-section">
          <p>Real-time delivery tracking</p>
          <p class="secondary-text">Track active riders and delivery routes</p>
        </div>
      </div>
    </div>

    <!-- Rider Login Page -->
    <div *ngIf="currentPage === 'riders'" class="page riders-page">
      <div class="page-header">
        <h2>üö¥ Rider Login</h2>
      </div>
      <div class="page-content">
        <div class="placeholder-section">
          <p>Rider portal access</p>
          <p class="secondary-text">Login to view your deliveries and status</p>
        </div>
      </div>
    </div>

    <!-- Fleet Manager Page (placeholder) -->
    <div *ngIf="currentPage === 'fleet-maintenance'" class="page fleet-page">
      <div class="page-header">
        <h2>üõ†Ô∏è Fleet</h2>
      </div>
      <div class="page-content">
        <div class="placeholder-section">
          <p>Fleet manager tools</p>
          <p class="secondary-text">Service scheduling, maintenance logs, inspections (coming next)</p>
        </div>
      </div>
    </div>

    <!-- Admin Roles Page (placeholder) -->
    <div *ngIf="currentPage === 'admin-roles'" class="page admin-page">
      <div class="page-header">
        <h2>üßë‚Äçüíº Admin: Roles</h2>
      </div>
      <div class="page-content">
        <div class="placeholder-section">
          <p>Role management</p>
          <p class="secondary-text">This will manage Cognito group membership (admin only)</p>
        </div>
      </div>
    </div>

    <!-- Events Page -->
    <div *ngIf="currentPage === 'events'" class="page events-page-container">
      <app-events-page></app-events-page>
    </div>

    <!-- Real-time Communications Page -->
    <div *ngIf="currentPage === 'communications'" class="page communications-page">
      <div class="page-header">
        <h2>üí¨ Real-time Communications</h2>
      </div>
      <div class="page-content">
        <div class="placeholder-section">
          <p>Instant messaging</p>
          <p class="secondary-text">Communicate with riders and team members in real-time</p>
        </div>
      </div>
    </div>

    <!-- Settings Page -->
    <div *ngIf="currentPage === 'settings'" class="page settings-page">
      <div class="page-header">
        <h2>‚öôÔ∏è Settings</h2>
      </div>
      <div class="page-content">
        <div class="placeholder-section">
          <p>Application settings</p>
          <p class="secondary-text">Customize your preferences</p>
        </div>
      </div>
    </div>

    <!-- Profile Page -->
    <div *ngIf="currentPage === 'profile'" class="page profile-page">
      <div class="page-header">
        <h2>üë§ Profile</h2>
      </div>
      <div class="page-content">
        <div class="placeholder-section">
          <p>Your profile information</p>
          <p class="secondary-text">View and manage your account details</p>
        </div>
      </div>
    </div>

    <!-- Help & Support Page -->
    <div *ngIf="currentPage === 'help'" class="page help-page">
      <div class="page-header">
        <h2>‚ùì Help & Support</h2>
      </div>
      <div class="page-content">
        <div class="placeholder-section">
          <p>Help center</p>
          <p class="secondary-text">Get support and view frequently asked questions</p>
        </div>
      </div>
    </div>
    </div>

  </main>

  <!-- Footer -->
  <footer class="app-footer">
    <p>&copy; 2025 Blood Bike. All rights reserved.</p>
  </footer>
</div>

